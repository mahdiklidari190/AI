<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BK-AI Chat | هوش مصنوعی پیشرفته</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0ea5e9;
      --primary-dark: #0284c7;
      --secondary: #a855f7;
      --light: #f8fafc;
      --dark: #1e293b;
      --success: #22c55e;
      --user-bubble: #dbeafe;
      --assistant-bubble: #f1f5f9;
      --glass-bg: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(255, 255, 255, 0.2);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .dark-theme {
      --light: #1e293b;
      --dark: #f8fafc;
      --glass-bg: rgba(30, 41, 59, 0.85);
      --glass-border: rgba(255, 255, 255, 0.1);
      --user-bubble: #1e40af;
      --assistant-bubble: #334155;
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background-color 0.3s, color 0.3s;
    }

    body {
      font-family: 'Segoe UI', 'Vazirmatn', sans-serif;
      background: linear-gradient(135deg, #e0f2fe 0%, #c7d2fe 100%);
      color: var(--dark);
      min-height: 100vh;
      overflow-x: hidden;
    }

    body.dark-theme {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    .header {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--glass-border);
      color: var(--dark);
      padding: 1rem;
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logo i {
      color: var(--primary);
      font-size: 2rem;
    }

    .header-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .theme-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--dark);
    }

    .contact-wrapper {
      position: relative;
    }

    .contact-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .contact-btn:hover {
      background: var(--primary-dark);
    }

    #contactPanel {
      display: none;
      position: absolute;
      top: 3rem;
      right: 0;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: var(--shadow);
      width: 260px;
      z-index: 1000;
      color: var(--dark);
    }

    #contactPanel p {
      margin: 0.5rem 0;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #contactPanel button {
      font-size: 0.75rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.3rem 0.7rem;
      cursor: pointer;
    }

    #contactPanel button:hover {
      background: var(--primary-dark);
    }

    .container {
      max-width: 1000px;
      margin: 2rem auto;
      padding: 1rem;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 0.5rem;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow);
    }

    .controls select, .controls button {
      padding: 0.7rem 1rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      color: var(--dark);
      cursor: pointer;
    }

    .controls button {
      background: var(--primary);
      color: white;
      border: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .controls button:hover {
      background: var(--primary-dark);
    }

    .chat-box {
      height: 500px;
      overflow-y: auto;
      border-radius: 12px;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 1.5rem;
      box-shadow: var(--shadow);
      border: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .message {
      padding: 1rem 1.2rem;
      border-radius: 18px;
      max-width: 80%;
      position: relative;
      line-height: 1.6;
      white-space: pre-wrap;
      animation: fadeIn 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .user {
      background: var(--user-bubble);
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }

    .assistant {
      background: var(--assistant-bubble);
      margin-right: auto;
      border-bottom-left-radius: 4px;
    }

    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .message-role {
      font-weight: bold;
      font-size: 0.9rem;
    }

    .timestamp {
      font-size: 0.7rem;
      color: #6b7280;
    }

    .message-actions {
      position: absolute;
      bottom: -1.2rem;
      left: 0.75rem;
      display: flex;
      gap: 0.5rem;
    }

    .copy-btn, .like-btn {
      font-size: 0.7rem;
      color: var(--primary);
      background: transparent;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.2rem;
    }

    .copy-btn.copied, .like-btn.liked {
      color: var(--success);
    }

    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem;
      background: var(--assistant-bubble);
      border-radius: 18px;
      margin-right: auto;
      max-width: 120px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .typing-dots {
      display: flex;
      gap: 0.2rem;
    }

    .typing-dots span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--primary);
      display: inline-block;
      animation: bounce 1.3s infinite ease-in-out;
    }

    .typing-dots span:nth-child(2) {
      animation-delay: 0.15s;
    }

    .typing-dots span:nth-child(3) {
      animation-delay: 0.3s;
    }

    @keyframes bounce {
      0%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-5px); }
    }

    .input-area {
      display: flex;
      margin-top: 1.5rem;
      gap: 0.5rem;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow);
    }

    input[type="text"] {
      flex: 1;
      padding: 0.8rem 1rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      color: var(--dark);
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--primary);
    }

    button.send-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    button.send-btn:hover {
      background: var(--primary-dark);
    }

    button.send-btn.stop {
      background: #ef4444;
    }

    button.send-btn.stop:hover {
      background: #dc2626;
    }

    .chat-history {
      display: none;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      padding: 1rem;
      margin-top: 1.5rem;
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    .chat-history h3 {
      margin-top: 0;
      font-size: 1.2rem;
      color: var(--primary);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .chat-history-list {
      display: grid;
      gap: 0.5rem;
    }

    .chat-history button {
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-align: right;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      padding: 0.8rem;
      border-radius: 8px;
      cursor: pointer;
      color: var(--dark);
    }

    .chat-history button:hover {
      background: var(--assistant-bubble);
    }

    .chat-history .delete-btn {
      color: #ef4444;
      background: none;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      padding: 0.2rem 0.5rem;
    }

    .welcome-message {
      text-align: center;
      padding: 2rem;
      color: var(--dark);
    }

    .welcome-message h2 {
      margin-bottom: 1rem;
      color: var(--primary);
    }

    .welcome-message p {
      margin-bottom: 1.5rem;
      opacity: 0.8;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 2rem;
    }

    .feature {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      text-align: center;
      box-shadow: var(--shadow);
    }

    .feature i {
      font-size: 2rem;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem 0.5rem;
      }
      
      .controls {
        flex-direction: column;
      }
      
      .message {
        max-width: 90%;
      }
      
      .chat-box {
        height: 400px;
        padding: 1rem;
      }
      
      .input-area {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">
      <i class="fas fa-robot"></i>
      <span>BK-AI چت هوشمند</span>
    </div>
    <div class="header-controls">
      <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
      </button>
      <div class="contact-wrapper">
        <button class="contact-btn" onclick="toggleContactPanel()">
          <i class="fas fa-phone-alt"></i>
          ارتباط با پشتیبانی
        </button>
        <div id="contactPanel">
          <p>
            <span>نام:</span>
            <strong>مهدی کلیدری</strong>
          </p>
          <p>
            <span>تلفن:</span>
            <strong>09211243320</strong>
            <button onclick="callNumber('09211243320')">
              <i class="fas fa-phone"></i>
            </button>
          </p>
          <p>
            <span>تلگرام:</span>
            <strong>@BK_1ir</strong>
            <button onclick="copyText(this, '@BK_1ir')">
              <i class="fas fa-copy"></i>
            </button>
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="controls">
      <select id="model">
        <option value="gpt-4o">AI-4o (پیشرفته)</option>
        <option value="gemini-2.5-pro">AI-2.5 Pro (حرفه‌ای)</option>
      </select>
      <div>
        <button onclick="newChat()">
          <i class="fas fa-plus"></i>
          چت جدید
        </button>
        <button onclick="toggleHistory()">
          <i class="fas fa-history"></i>
          تاریخچه چت
        </button>
      </div>
    </div>

    <div class="chat-box" id="chatBox">
      <div class="welcome-message">
        <h2>به BK-AI خوش آمدید!</h2>
        <p>یک همراه هوشمند برای پاسخگویی به سوالات شما</p>
        <div class="features">
          <div class="feature">
            <i class="fas fa-lightbulb"></i>
            <h3>هوشمند</h3>
            <p>پاسخ‌های دقیق و هوشمند</p>
          </div>
          <div class="feature">
            <i class="fas fa-bolt"></i>
            <h3>سریع</h3>
            <p>پاسخگویی در کسری از ثانیه</p>
          </div>
          <div class="feature">
            <i class="fas fa-shield-alt"></i>
            <h3>امن</h3>
            <p>محافظت از حریم خصوصی شما</p>
          </div>
        </div>
      </div>
    </div>

    <div class="typing-indicator" id="typingIndicator" style="display:none;">
      <div class="typing-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <span>در حال تایپ...</span>
    </div>

    <div class="input-area">
      <input type="text" id="userInput" placeholder="پیام خود را اینجا تایپ کنید..." />
      <button class="send-btn" id="sendBtn" onclick="sendMessage()">
        <i class="fas fa-paper-plane"></i>
        ارسال
      </button>
    </div>

    <div class="chat-history" id="chatHistory">
      <h3><i class="fas fa-history"></i> تاریخچه چت‌ها</h3>
      <div class="chat-history-list" id="chatHistoryList">
        <!-- Chat history will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    const chatBox = document.getElementById('chatBox');
    const userInput = document.getElementById('userInput');
    const modelSelect = document.getElementById('model');
    const typingIndicator = document.getElementById('typingIndicator');
    const chatHistory = document.getElementById('chatHistory');
    const chatHistoryList = document.getElementById('chatHistoryList');
    const contactPanel = document.getElementById('contactPanel');
    const sendBtn = document.getElementById('sendBtn');
    const themeToggle = document.getElementById('themeToggle');

    let messages = [];
    let chatId = Date.now().toString();
    let typingInterval = null;
    let stopTyping = false;

    // Check for saved theme preference
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-theme');
      themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    }

    // Theme toggle functionality
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
      if (document.body.classList.contains('dark-theme')) {
        localStorage.setItem('theme', 'dark');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
      } else {
        localStorage.setItem('theme', 'light');
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
      }
    });

    const formatTime = () => {
      const now = new Date();
      return now.toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' });
    };

    const renderMessages = () => {
      const isAtBottom = chatBox.scrollTop + chatBox.clientHeight >= chatBox.scrollHeight - 50;
      
      // Clear only messages, keep welcome if empty
      const welcomeMsg = chatBox.querySelector('.welcome-message');
      chatBox.innerHTML = '';
      
      if (messages.length === 0 && welcomeMsg) {
        chatBox.appendChild(welcomeMsg);
      } else {
        messages.forEach((msg) => {
          const messageDiv = document.createElement("div");
          messageDiv.className = `message ${msg.role === "user" ? "user" : "assistant"}`;
          
          const messageHeader = document.createElement("div");
          messageHeader.className = "message-header";
          
          const roleSpan = document.createElement("span");
          roleSpan.className = "message-role";
          roleSpan.textContent = msg.role === "user" ? "شما" : "BK-AI";
          
          const timeSpan = document.createElement("span");
          timeSpan.className = "timestamp";
          timeSpan.textContent = msg.time;
          
          messageHeader.appendChild(roleSpan);
          messageHeader.appendChild(timeSpan);
          
          const contentDiv = document.createElement("div");
          contentDiv.textContent = msg.content;
          
          messageDiv.appendChild(messageHeader);
          messageDiv.appendChild(contentDiv);
          
          if (msg.role === "assistant") {
            const actionsDiv = document.createElement("div");
            actionsDiv.className = "message-actions";
            
            const copyBtn = document.createElement("button");
            copyBtn.className = "copy-btn";
            copyBtn.innerHTML = '<i class="fas fa-copy"></i> کپی';
            copyBtn.onclick = () => {
              navigator.clipboard.writeText(msg.content);
              copyBtn.classList.add("copied");
              copyBtn.innerHTML = '<i class="fas fa-check"></i> کپی شد!';
              setTimeout(() => {
                copyBtn.classList.remove("copied");
                copyBtn.innerHTML = '<i class="fas fa-copy"></i> کپی';
              }, 2000);
            };
            
            const likeBtn = document.createElement("button");
            likeBtn.className = "like-btn";
            likeBtn.innerHTML = '<i class="far fa-thumbs-up"></i>';
            likeBtn.onclick = () => {
              likeBtn.classList.toggle("liked");
              likeBtn.innerHTML = likeBtn.classList.contains("liked") 
                ? '<i class="fas fa-thumbs-up"></i>' 
                : '<i class="far fa-thumbs-up"></i>';
            };
            
            actionsDiv.appendChild(copyBtn);
            actionsDiv.appendChild(likeBtn);
            messageDiv.appendChild(actionsDiv);
          }
          
          chatBox.appendChild(messageDiv);
        });
      }

      if (isAtBottom) {
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    };

    const simulateTyping = (reply) => {
      return new Promise((resolve) => {
        let i = 0;
        const replyText = reply;
        messages.push({ role: "assistant", content: "", time: formatTime() });
        renderMessages();
        
        typingInterval = setInterval(() => {
          if (stopTyping || i >= replyText.length) {
            clearInterval(typingInterval);
            resolve();
            return;
          }
          
          messages[messages.length - 1].content += replyText[i];
          renderMessages();
          i++;
        }, 30);
      });
    };

    const sendMessage = async () => {
      const content = userInput.value.trim();
      if (!content) return;

      const time = formatTime();
      messages.push({ role: "user", content, time });
      renderMessages();
      userInput.value = "";

      typingIndicator.style.display = "flex";
      sendBtn.classList.add("stop");
      sendBtn.innerHTML = '<i class="fas fa-stop"></i> توقف';
      sendBtn.onclick = stopMessage;
      stopTyping = false;

      try {
        const response = await fetch("https://api.gapgpt.app/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer sk-S5rOGsclcKTN9vdMMsx3fZ1bYXALVqBV0z8WebUcX668zia4"
          },
          body: JSON.stringify({
            model: modelSelect.value,
            messages: messages
          })
        });

        const data = await response.json();
        typingIndicator.style.display = "none";

        if (data.choices && data.choices.length > 0) {
          const reply = data.choices[0].message.content;
          await simulateTyping(reply);
        } else {
          throw new Error("پاسخی دریافت نشد");
        }
      } catch (error) {
        console.error("خطا در دریافت پاسخ:", error);
        const errorMsg = "متأسفم، در پردازش درخواست شما مشکلی پیش آمد. لطفاً دوباره تلاش کنید.";
        await simulateTyping(errorMsg);
      } finally {
        sendBtn.classList.remove("stop");
        sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> ارسال';
        sendBtn.onclick = sendMessage;
        saveChat();
      }
    };

    const stopMessage = () => {
      stopTyping = true;
      clearInterval(typingInterval);
      typingIndicator.style.display = "none";
      sendBtn.classList.remove("stop");
      sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> ارسال';
      sendBtn.onclick = sendMessage;
    };

    const saveChat = () => {
      const title = messages.find(m => m.role === "user")?.content?.slice(0, 30) || "چت جدید";
      localStorage.setItem("chat-" + chatId, JSON.stringify({ title, messages }));
    };

    const newChat = () => {
      if (messages.length > 0) {
        if (!confirm("آیا از ایجاد یک چت جدید اطمینان دارید؟ چت فعلی ذخیره خواهد شد.")) {
          return;
        }
      }
      chatId = Date.now().toString();
      messages = [];
      renderMessages();
    };

    const toggleHistory = () => {
      chatHistory.style.display = chatHistory.style.display === "none" ? "block" : "none";
      loadChatHistory();
    };

    const loadChatHistory = () => {
      chatHistoryList.innerHTML = "";
      
      const chatKeys = Object.keys(localStorage)
        .filter(k => k.startsWith("chat-"))
        .sort((a, b) => parseInt(b.split("-")[1]) - parseInt(a.split("-")[1]));
      
      if (chatKeys.length === 0) {
        chatHistoryList.innerHTML = "<p>هیچ تاریخچه چتی وجود ندارد</p>";
        return;
      }
      
      chatKeys.forEach(key => {
        const data = JSON.parse(localStorage.getItem(key));
        const chatItem = document.createElement("div");
        chatItem.className = "chat-item";
        
        const chatBtn = document.createElement("button");
        chatBtn.innerHTML = `
          <span>${data.title}</span>
          <button class="delete-btn" onclick="deleteChat('${key}', event)">
            <i class="fas fa-trash"></i>
          </button>
        `;
        
        chatBtn.onclick = () => {
          messages = data.messages;
          chatId = key.split("-")[1];
          renderMessages();
          chatHistory.style.display = "none";
        };
        
        chatHistoryList.appendChild(chatBtn);
      });
    };

    const deleteChat = (key, event) => {
      event.stopPropagation();
      if (confirm("آیا از حذف این چت اطمینان دارید؟")) {
        localStorage.removeItem(key);
        loadChatHistory();
      }
    };

    const toggleContactPanel = () => {
      contactPanel.style.display = contactPanel.style.display === "none" ? "block" : "none";
    };

    const copyText = (btn, text) => {
      navigator.clipboard.writeText(text);
      const originalHtml = btn.innerHTML;
      btn.innerHTML = '<i class="fas fa-check"></i> کپی شد!';
      setTimeout(() => {
        btn.innerHTML = originalHtml;
      }, 2000);
    };

    const callNumber = (number) => {
      window.location.href = `tel:${number}`;
    };

    // Event listeners
    chatBox.addEventListener("click", () => {
      contactPanel.style.display = "none";
    });

    userInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        sendMessage();
      }
    });

    // Initial render
    renderMessages();
  </script>
</body>
</html>
